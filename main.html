<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Enigmatic World</title>
    <link href="style.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos b√°sicos para o container principal e o iframe */
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; /* Evita barras de rolagem desnecess√°rias */
            height: 100vh; /* Garante que o body ocupe a altura total da viewport */
            display: flex; /* Para alinhar o iframe */
            flex-direction: column;
        }
        iframe {
            flex-grow: 1; /* Faz o iframe ocupar o espa√ßo restante */
            width: 100%;
            border: none; /* Remove a borda padr√£o do iframe */
        }
        .main-audio-controls {
            position: fixed; /* Fixa o controle de √°udio na tela */
            bottom: 20px;
            left: 20px;
            z-index: 1000; /* Garante que fique acima de outros elementos */
        }
        .main-audio-controls button {
            background-color: #4b0082; /* √çndigo */
            color: #ffffff;
            border: 2px solid #8a2be2; /* Azul violeta */
            padding: 10px 20px;
            font-family: 'Cinzel Decorative', serif;
            font-size: 1em;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .main-audio-controls button:hover {
            background-color: #6a0dad; /* P√∫rpura */
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <iframe id="gameFrame" src="index.html"></iframe>

    <div class="main-audio-controls">
        <button id="toggleMusicBtn">üé∂ M√∫sica: Ligar</button>
        <audio id="backgroundMusic" loop>
            <source src="assets/music_theme.mp3" type="audio/mpeg">
            Seu navegador n√£o suporta o elemento de √°udio.
        </audio>
    </div>

    <script>
        const backgroundMusic = document.getElementById("backgroundMusic");
        const toggleMusicBtn = document.getElementById("toggleMusicBtn");
        const gameFrame = document.getElementById("gameFrame");

        // Carrega a prefer√™ncia de √°udio do usu√°rio do localStorage
        let isMusicPlaying = localStorage.getItem("isMusicPlaying") === "true"; 
        
        // Atualiza o texto do bot√£o com base na prefer√™ncia
        toggleMusicBtn.textContent = isMusicPlaying ? "üé∂ M√∫sica: Desligar" : "üé∂ M√∫sica: Ligar";

        // Tenta tocar a m√∫sica se estiver configurada para ligar
        // NOTA: Navegadores podem bloquear autoplay. A primeira intera√ß√£o do usu√°rio ajudar√°.
        if (isMusicPlaying) {
            backgroundMusic.volume = 0.4; // Volume inicial
            backgroundMusic.play().catch(e => console.warn("Erro ao tentar tocar m√∫sica automaticamente:", e));
        }

        // Adiciona o listener para o bot√£o de toggle
        toggleMusicBtn.addEventListener("click", () => {
            if (backgroundMusic.paused) {
                backgroundMusic.volume = 0.4;
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                    toggleMusicBtn.textContent = "üé∂ M√∫sica: Desligar";
                }).catch(e => {
                    console.error("Erro ao tocar m√∫sica:", e);
                    // Adicione um feedback ao usu√°rio se o autoplay for bloqueado
                    alert("O navegador pode ter bloqueado a reprodu√ß√£o autom√°tica. Por favor, interaja novamente ou verifique as configura√ß√µes de m√≠dia.");
                });
            } else {
                backgroundMusic.pause();
                isMusicPlaying = false;
                toggleMusicBtn.textContent = "üé∂ M√∫sica: Ligar";
            }
            localStorage.setItem("isMusicPlaying", isMusicPlaying); // Salva a prefer√™ncia
        });

        // Opcional: Para controlar a m√∫sica a partir do script.js ou faseX.js dentro do iframe.
        // Isso n√£o √© estritamente necess√°rio para o controle de autoplay, mas pode ser √∫til para outras intera√ß√µes.
        window.addEventListener('message', (event) => {
            // Verifica se a mensagem veio do nosso iframe e tem um tipo esperado
            if (event.source === gameFrame.contentWindow && event.data && event.data.type === 'toggleMusic') {
                toggleMusicBtn.click(); // Simula o clique no bot√£o de toggle
            }
        });
    </script>
</body>
</html>
