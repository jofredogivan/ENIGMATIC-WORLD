<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enigmatic World</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet" />
</head>
<body>
    <div class="app-container"> <audio id="backgroundMusic" loop>
            <source src="assets/music_theme.mp3" type="audio/mpeg">
            Seu navegador nÃ£o suporta o elemento de Ã¡udio.
        </audio>

        <iframe id="gameFrame" src="index.html" style="width: 100%; height: 100%; border: none; background-color: white;"></iframe>
    </div>

    <button id="toggleMusicBtn" class="music-toggle-button">ðŸŽ¶ MÃºsica: Ligar</button>

    <script>
        const backgroundMusic = document.getElementById("backgroundMusic");
        const toggleMusicBtn = document.getElementById("toggleMusicBtn");
        const gameFrame = document.getElementById("gameFrame");

        let isMusicPlaying = localStorage.getItem("isMusicPlaying") === "true"; 
        
        toggleMusicBtn.textContent = isMusicPlaying ? "ðŸŽ¶ MÃºsica: Desligar" : "ðŸŽ¶ MÃºsica: Ligar";

        if (isMusicPlaying) {
            backgroundMusic.volume = 0.4;
            backgroundMusic.play().catch(e => {
                console.warn("Autoplay de mÃºsica bloqueado pelo navegador:", e);
                isMusicPlaying = false; 
                localStorage.setItem("isMusicPlaying", isMusicPlaying);
                toggleMusicBtn.textContent = "ðŸŽ¶ MÃºsica: Ligar";
            });
        }

        toggleMusicBtn.addEventListener("click", () => {
            if (backgroundMusic.paused) {
                backgroundMusic.volume = 0.4;
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                    toggleMusicBtn.textContent = "ðŸŽ¶ MÃºsica: Desligar";
                }).catch(e => {
                    console.error("Erro ao tentar tocar mÃºsica via botÃ£o:", e);
                    alert("NÃ£o foi possÃ­vel tocar a mÃºsica. O navegador pode ter bloqueado a reproduÃ§Ã£o automÃ¡tica.");
                });
            } else {
                backgroundMusic.pause();
                isMusicPlaying = false;
                toggleMusicBtn.textContent = "ðŸŽ¶ MÃºsica: Ligar";
            }
            localStorage.setItem("isMusicPlaying", isMusicPlaying);
        });

        window.addEventListener('message', (event) => {
            if (event.source === gameFrame.contentWindow && event.data && event.data.type === 'toggleMusic') {
                toggleMusicBtn.click(); 
            }
        });
        
        gameFrame.addEventListener('load', () => {
            if (gameFrame.contentWindow) {
                gameFrame.contentWindow.postMessage({
                    type: 'musicState',
                    isPlaying: isMusicPlaying
                }, '*'); 
            }
        });

        if (gameFrame.contentWindow && gameFrame.contentWindow.document.readyState === 'complete') {
            gameFrame.contentWindow.postMessage({
                type: 'musicState',
                isPlaying: isMusicPlaying
            }, '*');
        }
    </script>
</body>
</html>
